<!DOCTYPE html>
<html>
<head>
<title>AI 对话</title>
<style>
body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f0f0f0;
}

.container {
    width: 80%;
    max-width: 800px;
    margin: 20px auto;
    background-color: #fff;
    border-radius: 5px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

h1 {
    text-align: center;
    color: #333;
}

#chat-area {
    margin-bottom: 20px;
    border: 1px solid #ccc;
    padding: 10px;
    min-height: 200px;
    border-radius: 5px;
    background-color: #f9f9f9;
    overflow-y: scroll; /* 添加滚动条 */
}

#user-input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 10px;
    box-sizing: border-box; /* Ensure padding doesn't affect width */
}

button {
    background-color: #007bff;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #0056b3;
}

.message {
    padding: 8px;
    margin-bottom: 5px;
    border-radius: 5px;
    word-wrap: break-word; /* 防止长文本溢出 */
}

.user-message {
    background-color: #e2f0ff;
    text-align: right;
}

.ai-message {
    background-color: #f0f0f0;
    text-align: left;
}

#model-selector {
    margin-bottom: 10px;
}

.loading {
    display: none;
    text-align: center;
    margin-bottom: 10px;
}
</style>
</head>
<body>

<div class="container">
    <h1>AI 对话</h1>
    <div id="model-selector">
        <label for="model">选择模型:</label>
        <select id="model">
            <option value="deepseek-chat">deepseek-chat</option>
            <option value="deepseek-reasoner">deepseek-reasoner</option>
        </select>
    </div>
    <div id="chat-area">
        <!-- 对话内容显示在这里 -->
    </div>
    <div class="loading" id="loading-indicator">
        正在加载...
    </div>
    <input type="text" id="user-input" placeholder="请输入你的问题...">
    <button onclick="sendMessage()">发送</button>
</div>

<script>
const apiKey = "sk-2fe1931c1dc24ea8a13208d092b6ddbe"; // 替换为你的 DeepSeek API Key
const apiBaseUrl = "https://api.deepseek.com"; // DeepSeek API 基础 URL

async function sendMessage() {
    var userInput = document.getElementById("user-input").value;
    if (userInput.trim() === "") return;

    // 显示用户消息
    displayMessage(userInput, "user-message");

    // 获取选择的模型
    const selectedModel = document.getElementById("model").value;

    // 显示加载指示器
    document.getElementById("loading-indicator").style.display = "block";

    try {
        // 调用 DeepSeek API
        const response = await fetch(`${apiBaseUrl}/chat/completions`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
                "model": selectedModel,
                "messages": [
                    {"role": "system", "content": "You are a helpful assistant."},
                    {"role": "user", "content": userInput}
                ],
                "stream": false
            })
        });

        if (!response.ok) {
            // 尝试解析 JSON 错误信息
            let errorText = `HTTP error! status: ${response.status}`;
            try {
                const errorData = await response.json();
                errorText += ` - ${JSON.stringify(errorData)}`;
            } catch (e) {
                // 无法解析 JSON，使用原始错误信息
            }
            throw new Error(errorText);
        }

        const data = await response.json();
        console.log("API Response:", data); // 打印完整的 API 响应

        // 显示 AI 回复
        const aiResponse = data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message.content ? data.choices[0].message.content : "AI 返回了空回复。";
        displayMessage(aiResponse, "ai-message");

    } catch (error) {
        console.error("Error calling DeepSeek API:", error);
        displayMessage("Error: " + error.message, "ai-message"); // 显示错误信息
    } finally {
        // 隐藏加载指示器
        document.getElementById("loading-indicator").style.display = "none";
    }

    // 清空输入框
    document.getElementById("user-input").value = "";
}

function displayMessage(message, messageClass) {
    var chatArea = document.getElementById("chat-area");
    var messageDiv = document.createElement("div");
    messageDiv.classList.add("message");
    messageDiv.classList.add(messageClass);
    messageDiv.textContent = message;
    chatArea.appendChild(messageDiv);

    // 滚动到底部
    chatArea.scrollTop = chatArea.scrollHeight;
}
</script>

</body>
</html>
